---
const ITEMS = [
  {
    link: '/blog',
    label: 'Blog'
  },
  {
    link: '/projects',
    label: 'Projects'
  },
  {
    link: '/links',
    label: 'Links'
  },
  {
    link: '/about',
    label: 'About'
  }
]
---

<header-component
  class='group sticky top-4 z-30 mb-12 w-full rounded-lg bg-background py-1 transition-all sm:rounded-2xl'
>
  <header class='flex flex-wrap text-sm sm:flex-nowrap sm:justify-start'>
    <nav
      class='relative mx-auto flex w-full items-center justify-between sm:flex sm:items-center'
      aria-label='global'
    >
      <a class='flex-none text-xl font-semibold group-[.not-top]:ms-5' href='/' aria-label='Brand'
        >CWorld Site</a
      >

      <!-- menu -->
      <div class='flex gap-x-4 sm:gap-x-7'>
        <div
          id='headerExpandConetent'
          class='absolute end-0 start-0 top-12 z-10 grid rounded-lg py-1 opacity-0 transition-all duration-300 group-[.not-top]:border group-[.expanded]:bg-background group-[.not-top]:px-4 group-[.expanded]:opacity-100 sm:static sm:grid-rows-1 sm:border-0 sm:bg-inherit sm:px-0 sm:py-0 sm:opacity-100 sm:group-[.not-top]:border-0'
        >
          <div
            class='flex flex-col items-center justify-center gap-x-5 gap-y-2 overflow-hidden transition-colors sm:flex-row sm:gap-x-7'
          >
            {
              ITEMS.map((item) => (
                <a
                  href={item.link}
                  class='w-full flex-none grow py-3 text-right text-[1.05rem] font-medium hover:text-primary sm:w-fit sm:py-2'
                  aria-label='Nav Menu Item'
                >
                  {item.label}
                </a>
              ))
            }
          </div>
        </div>

        <!-- buttons -->
        <div class='flex gap-x-4 group-[.not-top]:me-1.5 group-[.not-top]:gap-x-2'>
          <a href='/search'>
            <button
              class='rounded-md border p-1.5 transition-all hover:bg-border sm:group-[.not-top]:rounded-xl'
            >
              <span class='sr-only'>Search</span>
              <svg class='size-5'>
                <use href='/icons/header.svg#mingcute-search-2-line'></use>
              </svg>
            </button>
          </a>

          <button
            id='toggleDarkMode'
            class='group/dark rounded-md border p-1.5 transition-all hover:bg-border sm:group-[.not-top]:rounded-xl'
          >
            <span class='sr-only'>Dark Theme</span>
            <svg class='size-5 transition-all group-hover/dark:text-primary dark:hidden'>
              <use href='/icons/header.svg#mingcute-sun-line'></use>
            </svg>
            <svg class='hidden size-5 transition-all group-hover/dark:text-primary dark:block'>
              <use href='/icons/header.svg#mingcute-moon-stars-line'></use>
            </svg>
          </button>
          <button
            id='toggleMenu'
            class='rounded-md border p-1.5 transition-all hover:bg-border sm:hidden sm:group-[.not-top]:rounded-xl'
          >
            <span class='sr-only'>Menu</span>
            <svg class='size-5'>
              <use href='/icons/header.svg#mingcute-menu-line'></use>
            </svg>
          </button>
        </div>
      </div>
    </nav>
  </header>
</header-component>

<script>
  class Header extends HTMLElement {
    constructor() {
      super()
    }

    connectedCallback() {
      // Header
      let preScrollY = window.scrollY
      if (preScrollY > 20) {
        this.classList.add('not-top')
      }

      window.addEventListener('scroll', () => {
        if (window.scrollY > 20) {
          this.classList.add('not-top')
        } else {
          this.classList.remove('not-top')
        }
        this.dataset.show = (window.scrollY < 350 || window.scrollY < preScrollY).toString()
        preScrollY = window.scrollY
      })

      // Dark Mode
      function getCurrentTheme() {
        return localStorage.getItem('theme')
      }
      const toggleDarkModeButton = this.querySelector('#toggleDarkMode')
      toggleDarkModeButton?.addEventListener('click', () => {
        const toggleDarkModeEvent = new CustomEvent('theme-change', {
          detail: { theme: getCurrentTheme() === 'light' ? 'dark' : 'light' }
        })
        document.dispatchEvent(toggleDarkModeEvent)
      })

      // Menu
      var style = document.createElement('style')
      style.innerHTML =
        '@media(max-width:640px){#headerExpandConetent{grid-template-rows:0fr}.expanded #headerExpandConetent{grid-template-rows:1fr}}'
      this.appendChild(style)
      const toggleMenuButton = this.querySelector('#toggleMenu')
      toggleMenuButton?.addEventListener('click', () => {
        if (this.classList.contains('expanded')) {
          this.classList.remove('expanded')
        } else {
          this.classList.add('expanded')
        }
      })
    }
  }
  customElements.define('header-component', Header)
</script>

<style>
  header-component[data-show='false']:not(.expanded) {
    transform: translateY(-4rem);
  }
  header-component.not-top {
    box-shadow:
      rgb(255, 255, 255) 0px 0px 0px 0px,
      rgba(24, 24, 27, 0.05) 0px 0px 0px 1px,
      rgba(39, 39, 42, 0.05) 0px 10px 15px -3px,
      rgba(39, 39, 42, 0.05) 0px 4px 6px -4px;
  }
  @media (min-width: 800px) {
    header-component.not-top {
      width: 80%;
    }
  }
  @media (max-width: 640px) {
    .expanded.not-top #headerExpandConetent {
      box-shadow:
        rgb(255, 255, 255) 0px 0px 0px 0px,
        rgba(24, 24, 27, 0.05) 0px 0px 0px 1px,
        rgba(39, 39, 42, 0.05) 0px 10px 15px -3px,
        rgba(39, 39, 42, 0.05) 0px 4px 6px -4px;
    }
  }
</style>
